# Matrix multiplication in Q
There is a build in matrix multiplication in q: mmu($ in k).
This is my attemp to implement it, and prepare to expand with other operators other than + and *.

Give matrix x and y
~~~q
    0N!x: enlist 1 2;
,1 2
~~~
~~~q
    show y: (1 0 2; 2 0 1)
1 0 2
2 0 1
~~~

You take a row x[i] from x, a column y[;j] from y, multiply them elementwisely, and take the sum
~~~q
    show x[0]
1 2
~~~
~~~q
    show y[;0]
1 2
~~~
~~~q
    show x[0] * y[;0]
1 4
~~~
~~~q
    show sum x[0] * y[;0]
5
~~~
and you do this for every row i of x and column j of y,
~~~q
    0N!x {sum x*y}/:\: flip y;
,5 0 4
~~~

# Performance measure
Given a 2000*2000 matrix,
~~~q
    N:2000
~~~
~~~q
    m:(N; 0N)#(N*N) ?100.0
~~~
~~~q
    show system "t mm[m; m]"
5813
~~~
~~~q
    show system "t m mmu m"
1947
~~~


# Rogui Hui's Inner Product - An Old/New Problem
Inspired by https://www.jsoftware.com/papers/innerproduct/ip1.htm,
I reimplemented it as below, but it's twice slower. Maybe because it need to hold full y in memory.
~~~q
    show x: (1 2; 3 4)
1 2
3 4
~~~
~~~q
    show y: (1 1 1; 1 1 1)
1 1 1
1 1 1
~~~
~~~q
    show x[0]*y
1 1 1
2 2 2
~~~
~~~q
    show (+/)x[0]*y
3 3 3
~~~
~~~q
    show {(+/)x*y}[x 0;y]
3 3 3
~~~
~~~q
    show@ '[(+/); *][x 0;y] /composition of sum and *
1 1 1
2 2 2
~~~
~~~q
    show x('[(+/);*])\:y
3 3 3
7 7 7
~~~
~~~q
    show system "ts mm[m; m]"
6162 65617488
~~~
## Library Code[^1]
~~~q
mm: {x {sum x*y}/:\: flip y}
mm0:  ('[(+/);*])\:
~~~

[^1]: This file is generated by [qnote2.q](https://github.com/co-dh/qnote)
